<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Home Budgeting</title>
  <link rel="stylesheet" href="app/css/styles.css">
  
</head>
<body>
  <header>
    <h1>Budget for <span id="header-month"></span></h1>
    <span class="pill" id="leftover-pill">Left Over £0.00</span>

      <div class="toolbar">
        <div class="inline-field">
          <label for="month-picker">Add Month</label>
          <input type="month" id="month-picker"/>
          <button id="new-month" title="Create a new month from template or copy last month">Add</button>
          <label for="open-month">Open Month</label>
          <select id="open-month"></select>
        </div>
        <button id="export-data">Export</button>
        <button id="import-trans">Import</button>
      </div>
  </header>

  <main>
    <div class="tabs" role="tablist">
      <button class="tab" role="tab" id="tab-budget" aria-selected="true">Budget</button>
      <button class="tab" role="tab" id="tab-transactions" aria-selected="false">Transactions</button>
      <button class="tab" role="tab" id="tab-analysis" aria-selected="false">Analysis</button>
      <button class="tab" role="tab" id="tab-calendar" aria-selected="false">Calendar</button>
      <button class="tab" role="tab" id="tab-notes" aria-selected="false">Notes</button>
      <button class="tab" role="tab" id="tab-learning" aria-selected="false">Prediction Map</button>
    </div>

      <section id="panel-budget" role="tabpanel">
        <div class="grid">
          <div class="card">
            <h2>Money In</h2>
            <div class="content">
              <div class="row">
                <input id="income-name" placeholder="Income name e.g. Salary, Interest"/>
                <input id="income-amount" type="number" step="0.01" placeholder="Amount"/>
                <button class="primary" id="add-income">Add Income</button>
              </div>
              </br>
              <div class="list" id="income-list"></div>
              <div class="kpi" style="margin-top:10px">
                <div><span>Total Income</span><strong id="total-income">£0.00</strong></div>
                <div><span>Income − Actual Expenses</span><strong id="leftover-actual">£0.00</strong></div>
              </div>
            </div>
          </div>

          <div class="card">
            <h2>Money Out – Categories</h2>
            <div class="content">
              <div class="row" style="margin-bottom:10px">
                <input id="cat-name" placeholder="Category name (e.g. Groceries)"/>
                <input id="cat-group" placeholder="Group (e.g. Food)"/>
                <input id="cat-budget" type="number" step="0.01" placeholder="Budget"/>
                <button class="primary" id="add-category">Add/Update Category</button>
                <button class="secondary" id="collapse-all" title="Collapse all groups">Collapse All</button>
                <button class="secondary" id="expand-all" title="Expand all groups">Expand All</button>
              </div>

              <table class="table" id="category-table">
                <thead>
                  <tr>
                    <th>Group</th>
                    <th>Category</th>
                    <th class="right">Budget</th>
                    <th class="right">Actual</th>
                    <th class="right">Difference</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr>
                    <td><strong>Totals</strong></td>
                    <td></td>
                    <td class="right" id="tot-bud">£0.00</td>
                    <td class="right" id="tot-act">£0.00</td>
                    <td class="right" id="tot-diff">£0.00</td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
              <div class="footer-note">Tip: Click a row to edit. Difference = Budget − Actual.</div>
            </div>
          </div>

        </div>
      </section>

    <section id="panel-transactions" role="tabpanel" class="hidden">
      <div class="two-col">
        <div class="card">
          <h2><span>Monthly Transactions</span><span id="tx-total">£0.00</span></h2>
          <div class="content">
            <div class="row">
              <input id="tx-search" placeholder="Search description" />
              <select id="tx-filter-cat" title="Filter by Category"></select>
            </div>
            </br>
            <div class="list" id="tx-list"></div>
            </br>
            <div class="right actions">
              <button id="tx-delete-all" class="icon-btn" aria-label="Delete All"></button>
              <button id="tx-jump" class="icon-btn" aria-label="Bottom"></button>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Add Transaction</h2>
          <div class="content">
            <div class="row">
              <input id="tx-date" type="date" placeholder="Date" title="Transaction Date" />
              <input id="tx-desc" placeholder="Description (e.g. Waitrose)" />
              <input id="tx-amt" type="number" step="0.01" placeholder="Amount (positive = spend)" />
              <select id="tx-cat" title="Category"></select>
            </div>
            <div id="desc-tooltip" class="tooltip hidden"></div>
            </br>
            <div class="row">
              <button class="primary" id="add-tx">Add</button>
              <span id="predict-hint" class="badge">Prediction: –</span>
              <span id="desc-predict-hint" class="badge">Desc: –</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="panel-analysis" role="tabpanel" class="hidden">
      <div class="two-col-analysis">
        <div class="card">
          <h2>Analysis Options</h2>
          <div class="content">
            <div class="row">
              <label>Analysis
                <select id="analysis-select">
                  <option value="budget-spread" selected>Budget Spread</option>
                  <option value="monthly-spend">Monthly Spend</option>
                </select>
              </label>
            </div>
            <div class="row hidden" id="analysis-month-row">
              <label>Month
                <select id="analysis-month"></select>
              </label>
            </div>
            <div class="row hidden" id="analysis-group-row">
              <label>Group
                <select id="analysis-group"></select>
              </label>
            </div>
            <div class="row hidden" id="analysis-category-row">
              <label>Category
                <select id="analysis-category"></select>
              </label>
            </div>
            <div class="row">
              <label>Chart Style
                <select id="analysis-chart-type">
                  <option value="line">Line Chart</option>
                  <option value="bar" selected>Vertical Bar Chart</option>
                </select>
              </label>
            </div>
          </div>
        </div>
        <div class="card">
          <h2>Analysis Chart</h2>
          <div class="content" id="analysis-charts">
            <div>
              <h3 id="analysis-planned-title" class="hidden">Planned</h3>
              <canvas id="analysis-chart"></canvas>
            </div>
            <div>
              <h3 id="analysis-actual-title" class="hidden">Actual</h3>
              <canvas id="analysis-chart-actual" class="hidden"></canvas>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="panel-learning" role="tabpanel" class="hidden">
      <div class="card">
        <h2>Description → Category Map (auto‑learning)</h2>
        <div class="content">
          <p class="footer-note">The app learns from your transactions. It tokenises descriptions and builds a frequency map to predict categories. You can pin exact matches below.</p>
          <div class="row">
            <input id="learn-desc" placeholder="Exact description e.g. Waitrose"/>
            <select id="learn-cat" title="Category"></select>
            <button class="primary" id="learn-add">Pin Mapping</button>
          </div>
          <div class="list" id="learn-list"></div>
        </div>
      </div>
    </section>
  </main>
  <dialog id="import-dialog" class="dialog">
    <div class="dialog-content">
      <div class="row">
        <label>Data
          <select id="import-kind">
            <option value="transactions">Monthly Transactions</option>
            <option value="categories">Money Out – Categories</option>
            <option value="prediction">Prediction Map</option>
            <option value="all">All Data</option>
          </select>
        </label>
      </div>
      <div class="row" id="import-month-row">
        <label>Month <input type="month" id="import-month"/></label>
      </div>
      <div class="row" id="import-type-row">
        <label>File Type
          <select id="import-type">
            <option value="json">JSON</option>
            <option value="csv">CSV</option>
          </select>
        </label>
      </div>
      <div class="row">
        <input id="import-file" type="file" accept="application/json,.json,.csv"/>
      </div>
      <div class="dialog-actions">
        <button id="import-confirm" class="primary">Import</button>
        <button id="import-cancel" class="secondary">Cancel</button>
      </div>
    </div>
  </dialog>
  <dialog id="csv-map-dialog" class="dialog">
    <div class="dialog-content">
      <p>Match CSV columns to expected fields</p>
      <div class="row"><span>Date</span><select id="csv-map-date"></select></div>
      <div class="row"><span>Description</span><select id="csv-map-desc"></select></div>
      <div class="row"><span>Category</span><select id="csv-map-cat"></select></div>
      <div class="row"><span>Amount</span><select id="csv-map-amt"></select></div>
      <div class="row"><label><input type="checkbox" id="csv-map-header" checked/> File has header row</label></div>
      <div class="row"><label><input type="checkbox" id="csv-map-invert"/> Invert amount signs</label></div>
      <div class="dialog-actions">
        <button id="csv-map-confirm" class="primary">Import</button>
        <button id="csv-map-cancel" class="secondary">Cancel</button>
      </div>
    </div>
  </dialog>
  <dialog id="export-dialog" class="dialog">
    <div class="dialog-content">
      <div class="row">
        <label>Data
          <select id="export-kind">
            <option value="transactions">Monthly Transactions</option>
            <option value="categories">Money Out – Categories</option>
            <option value="prediction">Prediction Map</option>
            <option value="all">All Data</option>
          </select>
        </label>
      </div>
      <div class="row" id="export-month-row">
        <label>Month <input type="month" id="export-month"/></label>
      </div>
      <div class="row" id="export-type-row">
        <label>File Type
          <select id="export-type">
            <option value="json">JSON</option>
            <option value="csv">CSV</option>
          </select>
        </label>
      </div>
      <div class="dialog-actions">
        <button id="export-confirm" class="primary">Export</button>
        <button id="export-cancel" class="secondary">Cancel</button>
      </div>
    </div>
  </dialog>
  <dialog id="calendar-dialog" class="dialog">
    <div class="dialog-content">
      <div class="calendar-header">
        <button id="calendar-prev" aria-label="Previous month">&#9664;</button>
        <div id="calendar-month"></div>
        <button id="calendar-next" aria-label="Next month">&#9654;</button>
      </div>
      <div id="calendar-container"></div>
      <div class="dialog-actions">
        <button id="calendar-close" class="primary">Close</button>
      </div>
    </div>
  </dialog>
  <dialog id="notes-dialog" class="dialog">
    <div class="dialog-content">
      <div class="row">
        <input id="note-desc" placeholder="Description"/>
      </div>
      <div class="row">
        <textarea id="note-data" placeholder="Note" rows="4"></textarea>
      </div>
      <button id="add-note" class="primary">Add Note</button>
      <div class="list" id="notes-list"></div>
      <div class="dialog-actions">
        <button id="notes-close" class="primary">Close</button>
      </div>
    </div>
  </dialog>
  <dialog id="dialog" class="dialog">
    <div class="dialog-content">
      <p id="dialog-message"></p>
      <div class="dialog-actions">
        <button id="dialog-ok" class="primary">OK</button>
        <button id="dialog-cancel" class="secondary hidden">Cancel</button>
      </div>
    </div>
  </dialog>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="app/js/app.js"></script>
</body>
</html>
